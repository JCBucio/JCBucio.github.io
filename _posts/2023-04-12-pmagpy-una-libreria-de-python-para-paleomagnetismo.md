---
layout: post
title: PmagPy. Una librer√≠a de Python para Paleomagnetismo
tags: [Python, Geof√≠sica, PmagPy, Paleomagnetismo, Magnetismo]
excerpt_separator: <!--more-->
permalink: /blog/:year/:title
thumbnail: "assets/img/thumbnails/nasa-unsplash.jpg"
feature-img: "assets/img/thumbnails/nasa-unsplash.jpg"
---
[PmagPy](https://github.com/PmagPy/PmagPy){:target="_blank" rel="noopener noreferrer"} es una librer√≠a *open source* de *Python* con una serie de herramientas para el procesamiento, an√°lisis e interpretaci√≥n de datos paleomagn√©ticos. Esta librer√≠a cuenta con un conjunto de funciones escritas en *Python* para ser utilizadas en scripts √≥ *Jupyter Notebooks*.

<!--more-->

üí° Parte del contenido de este post fu√© creado con ayuda de ChatGPT[^2] y Github Copilot[^3], dos herramientas de IA que generan texto y c√≥digo mediante el uso de modelos de lenguaje natural. Todo el contenido generado por medio de dichas herramientas fu√© revisado cuidadosamente.

* TOC
{:toc}

<br>

## Paleomagnetismo. Midiendo el campo magn√©tico de las rocas
El **Paleomagnetismo** es el estudio de las propiedades magn√©ticas de las rocas a lo largo del tiempo. Es una de las disciplinas de la Geof√≠sica m√°s aplicable en m√∫ltiples √°reas como el geomagnetismo, tect√≥nica, paleocenograf√≠a, vulcanolog√≠a, paleontolog√≠a, y sedimentolog√≠a, entre otras.

Para poder comprender c√≥mo las rocas adquieren propiedades magn√©ticas es necesario entender el funcionamiento del Campo Magn√©tico Terrestre (CMT). El CMT es, como su nombre lo indica, el campo magn√©tico que rodea la Tierra, generado desde la formaci√≥n de la Tierra misma. Este campo magn√©tico es generado por corrientes el√©ctricas en el n√∫cleo externo de la Tierra, que est√° compuesto principalmente de hierro l√≠quido y n√≠quel.

El proceso de formaci√≥n del campo magn√©tico terrestre est√° relacionado con la convecci√≥n del material fundido en el n√∫cleo externo de la Tierra. Esta convecci√≥n crea corrientes el√©ctricas que generan el campo magn√©tico.

Adem√°s, la rotaci√≥n de la Tierra tambi√©n contribuye al campo magn√©tico terrestre, ya que las corrientes el√©ctricas generadas por la convecci√≥n del n√∫cleo interact√∫an con la rotaci√≥n de la Tierra para producir un efecto d√≠namo.

<!-- Include a gif -->

<br>

{% include aligner.html images="posts-img/reversalanimation.gif" %}
<figcaption>Modelo num√©rico tridimensional de una inversi√≥n del campo geomagn√©tico (Glatzmaier & Roberts, 1995). Recuperado de <a href="https://www.nature.com/articles/377203a0" target="_blank" rel="noopener noreferrer">https://www.nature.com/articles/377203a0</a></figcaption>

<br>

## PmagPy. Un paquete completo para an√°lisis paleomagn√©ticos
*PmagPy*[^5] es un conjunto de herramientas escritas en *Python* para el an√°lisis de datos paleomagn√©ticos. Esta librer√≠a facilita la interpretaci√≥n de estudios magn√©ticos como la desmagnetizaci√≥n de rocas u obtenci√≥n de paleointensidades. El paquete est√° hosteado en [Github](https://github.com/PmagPy/PmagPy){:target="_blank" rel="noopener noreferrer"} y puede ser instalado por medio de [PyPI](https://pypi.org/project/pmagpy/){:target="_blank" rel="noopener noreferrer"}. A su vez, *PmagPy* est√° dise√±ada para trabajar con el formato de la base de datos [MagIC](https://earthref.org/MagIC){:target="_blank" rel="noopener noreferrer"}, descrita m√°s adelante en este post.

Algunos de los principales usos y utilidades de *PmagPy* incluyen:

- **Procesamiento de datos**: *PmagPy* incluye herramientas para el procesamiento y filtrado de datos paleomagn√©ticos, como la desmagnetizaci√≥n t√©rmica o de campo alternante. Estas herramientas ayudan a eliminar cualquier ruido o se√±ales no deseadas en los datos.

- **An√°lisis direccional**: *PmagPy* incluye una serie de herramientas para el an√°lisis direccional, como el c√°lculo de direcciones medias, polos geomagn√©ticos virtuales y estad√≠sticas de variaci√≥n paleosecular. Estas herramientas ayudan a caracterizar la direcci√≥n e intensidad del campo magn√©tico de la Tierra en el momento en que se formaron las rocas.

- **An√°lisis de magnitud**: *PmagPy* incluye herramientas para estimar la paleointensidad del campo magn√©tico de la Tierra utilizando una variedad de m√©todos como el m√©todo de *Thellier-Coe* y sus variaciones, el m√©todo *Shaw*, as√≠ como el protocolo *IZZI*.

- **Pruebas estad√≠sticas**: *PmagPy* incluye una serie de pruebas estad√≠sticas para datos paleomagn√©ticos, como la prueba de pliegues, la prueba de inversi√≥n y la prueba de conglomerados. Estas pruebas se utilizan para evaluar la fiabilidad y significancia de los datos paleomagn√©ticos.

- **Visualizaci√≥n de datos**: *PmagPy* incluye herramientas para visualizar datos paleomagn√©ticos, como estereogramas, gr√°ficas para temperaturas de *Curie*, gr√°ficas de *Day*, entre otras. Estas herramientas ayudan a identificar patrones y tendencias en los datos y a comunicar los resultados a otros.

<br>

{% include aligner.html images="posts-img/pmagpy_logo.png" %}
<figcaption>Logo de PmagPy.</figcaption>

<br>

*PmagPy* tiene los siguientes formatos disponibles:

- **M√≥dulos con funciones para tratamiento de datos**: En esta secci√≥n se encuentra un conjunto de herramientas para c√°lculos (`pmagpy.pmag`), graficaci√≥n (`pmagpy.pmagplotlib`), as√≠ como an√°lisis de datos con mayor nivel de complejidad (`pmagpy.ipmag`) que pueden ser realizados por medio de Python en un *Jupyter Notebook* o *Jupyter Lab*.

- **Una interfaz gr√°fica de usuario (GUI)**: Una *GUI* √≥ *Graphical User Interface* por sus siglas en ingl√©s, es cualquier aplicaci√≥n de escritorio que permite su uso de una manera m√°s sencilla por medio de un dise√±o m√°s intuitivo para el usuario. La *GUI* de *PmagPy* permite a los usuarios obtener datos en formato *MagIC* o bien, convertirlos a este mismo formato.

- **Programas para l√≠nea de comandos (CLIs)**: Las *CLIs* √≥ *Command Line Interfaces* por sus siglas en ingl√©s, son programas dise√±ados para realizar tareas o c√°lculos muy espec√≠ficos que no requieren de una interfaz de usuario y pueden ser ejecutados mediante una l√≠nea de comandos. Estos programas se pueden encontrar en el [repositorio de PmagPy](https://github.com/PmagPy/PmagPy){:target="_blank" rel="noopener noreferrer"}.

**NOTA:** Este post se centra en el uso de *PmagPy* como **librer√≠a de Python**. Para conocer m√°s sobre la *GUI* de *PmagPy* y los programas de l√≠nea de comandos, se recomienda visitar la [documentaci√≥n oficial](https://pmagpy.github.io/PmagPy-docs/intro.html){:target="_blank" rel="noopener noreferrer"}.

<br>

### Ejemplo de uso: Procesamiento de datos de rocas provenientes de flujos de lava del volc√°n Xitle, M√©xico

En este ejemplo se muestra el uso de *PmagPy* junto con otras librer√≠as de *Python* para realizar el procesamiento de datos de rocas provenientes de flujos de lava del volc√°n Xitle, M√©xico, que recibieron tratamientos magn√©ticos mediante campos alternos progresivos.[^4]

Las librer√≠as de *Python* utilizadas en este ejemplo son:

- **[PmagPy](https://pmagpy.github.io/PmagPy-docs/intro.html){:target="_blank" rel="noopener noreferrer"}**: An√°lisis y procesamiento de datos paleomagn√©ticos.
- **[Pandas](https://pandas.pydata.org/){:target="_blank" rel="noopener noreferrer"}**: An√°lisis y manipulaci√≥n de datos mediante `DataFrames`.
- **[Numpy](https://numpy.org/){:target="_blank" rel="noopener noreferrer"}**: Herramientas para c√≥mputo cient√≠fico.
- **[Matplotlib](https://matplotlib.org/){:target="_blank" rel="noopener noreferrer"}**: Visualizaci√≥n de datos mediante gr√°ficas y figuras.
- **[os](https://docs.python.org/es/3.10/library/os.html){:target="_blank" rel="noopener noreferrer"}**: Herramientas para el manejo de archivos y directorios.
- **[time](https://docs.python.org/3/library/time.html){:target="_blank" rel="noopener noreferrer"}**: Herramientas para manipular fechas, horas o a√±adir cronometraje.

**NOTA:** Las siguientes celdas de c√≥digo llevan una descripci√≥n con el orden en el que deben ser ejecutadas (*Parte 1/5*...). Esto es de utilidad para aquellos que deseen reproducir el ejemplo en una *Jupyter Notebook* √≥ un script de *Python*.

```python
import pmagpy.pmag as pmag
import pmagpy.ipmag as ipmag
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import os
import time
```
<figcaption>Parte 1/4. Importaci√≥n de librer√≠as en Python.</figcaption>

<br>

#### Tratamiento de datos en formato `.jr6`

El formato `.jr6` es generado por el instrumento [AGICO JR-6](https://www.agico.com/text/products/jr6/jr6.php){:target="_blank" rel="noopener noreferrer"} el cual se utiliza para medir la magnetizaci√≥n remanente de rocas basado en principios cl√°sicos (no cu√°nticos y no criog√©nicos). Su sensibilidad permite medir rocas con una magnetizaci√≥n remanente muy d√©bil, por ejemplo, varias rocas sedimentarias.

El formato en el que el instrumento JR-6 guarda los datos es `.jr6`, este formato es un archivo de texto plano en el que cada l√≠nea representa una medici√≥n del campo magn√©tico de la roca junto con varias columnas que contienen informaci√≥n de cada medici√≥n. A continuaci√≥n se muestra un ejemplo de las columnas que contiene un archivo `.jr6` utilizado en el estudio del volc√°n Xitle:

| Columna | Descripci√≥n |
| --- | --- |
| *sample* | Nombre de la muestra |
| *step* | Valor m√°ximo del campo aplicado en cada paso de desmagnetizaci√≥n en $$mT$$ |
| *mx*, *my* y *mz* | Componentes de la magnetizaci√≥n medida en cada paso en coordenadas de la muestra |
| *exp* | Exponente base 10 al que hay que convertir los valores de $$M$$ |
| *dec* | Declinaci√≥n magn√©tica |
| *inc* | Inclinaci√≥n magn√©tica |

Para realizar el procesamiento de datos de este ejemplo se hizo la conversi√≥n de  `.jr6` a `.csv` mediante una peque√±a rutina elaborada en *Python*. A continuaci√≥n se muestra el c√≥digo utilizado para realizar la conversi√≥n:

```python
jr6_format = 'xitle_data/jr6_format/' # Directorio con los archivos jr6
txt_format = 'xitle_data/txt_format/' # Directorio donde se guardar√°n los archivos txt
csv_format = 'xitle_data/csv_format/' # Directorio donde se guardar√°n los archivos csv

jr6_files = [f for f in os.listdir(jr6_format) if f.endswith('.jr6')]

for file in jr6_files: # Iterar sobre los archivos jr6
    file_name = file.split('.')[0]
    with open(jr6_format + file, 'r') as f:
        lines = f.readlines()
        data = [line.split() for line in lines]

    with open(txt_format + file_name + '.txt', 'w') as f: # Guardar los datos en formato txt
        f.write('sample\tstep\tmx\tmy\tmz\texp\tdec\tinc\n')
        for line in data:
            f.write('\t'.join(line))
            f.write('\n')

    df = pd.DataFrame(columns=['sample', 'step', 'mx', 'my', 'mz', 'exp', 'dec', 'inc']) # Generar un DataFrame con los datos
    for line in data:
        df = df.append({'sample': line[0], 'step': line[1], 'mx': line[2], 'my': line[3], 'mz': line[4], 'exp': line[5], 'dec': line[6], 'inc': line[7]}, ignore_index=True)

    df.to_csv(csv_format + file_name + '.csv', index=False) # Guardar los datos en formato csv
```
<figcaption>Parte 2/4. C√≥digo para la conversi√≥n de archivos jr6 a csv.</figcaption>

<br>

*PmagPy* tambi√©n cuenta con funciones que nos permiten realizar conversiones de formatos que generan diferentes instrumentos de medici√≥n. Algunas conversiones que *PmagPy* puede realizar mediante el m√≥dulo `pmagpy.convert_2_magic` son:

- `._2g_asc_magic()`: Conversi√≥n de archivos 2G ascii a formato MagIC.
- `._2g_bin_magic()`: Conversi√≥n de archivos 2G binarios a formato MagIC.
- `.jr6_jr6_magic()`: Conversi√≥n de archivos del spinner AGICO JR6 a formato MagIC.
- `.jr6_txt_magic()`: Conversi√≥n de archivos de texto AGICO JR6 a formato MagIC.
- `.agm_magic()`: Conversi√≥n de archivos de magnetizaci√≥n de fuerza de gradiente alterno (AGM) a formato MagIC.

Para obtener m√°s informaci√≥n sobre las funciones de conversi√≥n de *PmagPy* se puede consultar la documentaci√≥n oficial de la librer√≠a en [ este enlace](https://pmagpy.github.io/PmagPy-docs/documentation_notebooks/PmagPy_MagIC.html#conversion-scripts){:target="_blank" rel="noopener noreferrer"}.

<br>

#### C√°lculos de magnetizaci√≥n total, declinaci√≥n e inclinaci√≥n

Una vez obtenidos los `csv` con el formato correcto se crearon las siguientes 4 funciones para realizar los c√°lculos correspondientes de las columnas faltantes (*M(A/m)*, *Dec.*, *Inc.*):

```python
def inclination(x, y, z):
    inc = np.arctan(z / (np.sqrt((x**2) + (y**2))))
    return np.degrees(inc)

def declination(x, y):
    dec = np.arctan(y / x)
    return np.degrees(dec)

def mag_total(x, y, z):
    mag = np.sqrt((x**2) + (y**2) + (z**2))
    return mag

def mag_rel(m, max_m):
    return m / max_m
```
<figcaption>Parte 3/4. Funciones para el c√°lculo de magnetizaci√≥n total, declinaci√≥n e inclinaci√≥n.</figcaption>

<br>

Donde:

- `inclination(x, y, z)`: Calcula la inclinaci√≥n magn√©tica de una muestra a partir de las componentes de la magnetizaci√≥n en coordenadas de la muestra.

$$ I = \arctan \left( \frac{M_z}{\sqrt{(M_x^2 + M_y^2)}} \right) $$

- `declination(x, y)`: Calcula la declinaci√≥n magn√©tica de una muestra a partir de las componentes de la magnetizaci√≥n en coordenadas de la muestra.

$$ D = \arctan \left( \frac{M_y}{M_x} \right) $$

- `mag_total(x, y, z)`: Calcula la magnetizaci√≥n total de una muestra a partir de las componentes de la magnetizaci√≥n en coordenadas de la muestra.

$$ M = \sqrt{(M_x^2 + M_y^2 + M_z^2)} $$

- `mag_rel(m, max_m)`: Calcula la magnetizaci√≥n relativa de una muestra a partir de la magnetizaci√≥n total y la magnetizaci√≥n m√°xima.

$$ M_r = \frac{M}{M_{max}} $$

<br>

Finalmente, mediante un *loop* se realiza el c√°lculo para cada medici√≥n de cada muestra:

```python
csv_format_path = 'xitle_data/csv_format/'
files = os.listdir(csv_format_path)

for file in files:
    df = pd.read_csv(dir_path + file)

    df['calc_inc'] = inclination(df['mx'], df['my'], df['mz'])
    df['calc_dec'] = declination(df['mx'], df['my'])
    df['m'] = mag_total(df['mx'], df['my'], df['mz'])
    df['M'] = mag_rel(df['m'], max(df['m']))

    df.to_csv(csv_format_path + file, index=False)
```
<figcaption>Parte 4/4. Loop para el c√°lculo de las columnas faltantes.</figcaption>

<br>

#### Estereogramas √≥ *equal area projections*
En Paleomagnetismo, a menudo deseamos comparar direcciones de partes distantes del globo. Hay una dificultad al comparar direcciones magn√©ticas de lugares lejanos debido a que la inclinaci√≥n magn√©tica var√≠a mucho con la latitud. Para solucionar esto, se puede utilizar una t√©cnica matem√°tica llamada **proyecci√≥n de √°rea igual** √≥ *equal area projection*, por su definici√≥n en ingl√©s, que permite representar los datos en un mapa de forma que la direcci√≥n esperada del campo magn√©tico en cada sitio de muestreo sea el centro de la proyecci√≥n. Esto facilita la comparaci√≥n de las direcciones magn√©ticas entre diferentes sitios de muestreo.[^1]

En *PmagPy* se pueden generar este tipo de proyecciones, tambi√©n llamadas estereogramas mediante el uso de las funciones `ipmag.plot_net()` para graficar el estereograma y `ipmag.plot_di()` para graficar las direcciones de los datos. A continuaci√≥n se muestra un ejemplo de la graficaci√≥n de un estereograma para una de nuestras muestras:

**NOTA:** A partir de esta secci√≥n los bloques de c√≥digo **NO** deben seguir un orden espec√≠fico para que el c√≥digo funcione correctamente.

```python
example = pd.read_csv('xitle_data/dec_inc_calculated/95X001A.csv') # Cargamos los datos de la muestra 95X001A

# Pasamos las columnas con las declinaciones e inclinaciones a listas
ex_dec = example['calc_dec'].to_list()
ex_inc = example['calc_inc'].to_list()

plt.figure(figsize=(10, 10)) # Definimos el tama√±o de la figura
ipmag.plot_net(fignum=1) # Graficamos el estereograma
ipmag.plot_di(dec=ex_dec, inc=ex_inc, color='red', markersize=20, label='95X001A') # Graficamos las direcciones de los datos
plt.legend() # Mostramos la leyenda
plt.show()
```
<figcaption>Bloque de c√≥digo para la graficaci√≥n de una proyecci√≥n de √°rea igual (estereograma).</figcaption>

<br>

Output:

{% include aligner.html images="posts-img/95X001A_estereo.png" column=1 %}
<figcaption>Estereograma de la muestra 95X001A.</figcaption>

<br>

#### Diagramas de Zijderveld √≥ proyecciones ortogonales

El proceso de desmagnetizaci√≥n utilizado por los paleomagnetistas para estudiar la magnetizaci√≥n remanente de las rocas consiste en someter la muestra a una serie de pasos de desmagnetizaci√≥n y medir la magnetizaci√≥n despu√©s de cada paso hasta que se a√≠sla el componente m√°s estable, a este punto se le llama magnetizaci√≥n remanente caracter√≠stica o *ChRM*.[^1]

La visualizaci√≥n de los datos de desmagnetizaci√≥n es un problema complicado porque los datos son tridimensionales, por lo que los paleomagnetistas suelen usar un conjunto de dos proyecciones de los vectores, una en el plano horizontal y otra en el plano vertical, llamadas **diagramas de Zijderveld** √≥ **proyecciones ortogonales**.

En *PmagPy* se pueden generar estas proyecciones ortogonales y otras gr√°ficas para an√°lisis de resultados de desmagnetizaci√≥n con la funci√≥n `pmagplotlib.plot_zed()`, la cual genera un estereograma, un diagrama de Zijderveld (proyecci√≥n ortogonal) y un diagrama de desmagnetizaci√≥n. Debido a que esta funci√≥n genera 3 gr√°ficas por default, no es tan personalizable. Para fines m√°s visuales se gener√≥ el siguiente c√≥digo para generar solamente las proyecciones ortogonales de manera m√°s personalizada:

```python
example = pd.read_csv('xitle_data/dec_inc_calculated/95X001A.csv') # Cargamos los datos de la muestra 95X001A

# Pasamos las columnas de las direcciones a listas
x = example['mx'].to_list()
y = example['my'].to_list()
z = example['mz'].to_list()

plt.figure(figsize=(10, 10))

plt.title('95X001A')
plt.plot(x, y, 's--', c='red', label='Mx vs My', markersize=4) # Graficamos la proyecci√≥n horizontal
plt.plot(x, z, 's--', c='blue', label='Mx vs Mz', markersize=4) # Graficamos la proyecci√≥n vertical
plt.axhline(0, c='black', alpha=0.5) # Graficamos la l√≠nea horizontal en 0
plt.axvline(0, c='black', alpha=0.5) # Graficamos la l√≠nea vertical en 0

# Anotamos los pasos de desmagnetizaci√≥n en las proyecciones
for i, txt in enumerate(example['step']):
    plt.annotate(txt, (x[i], y[i]), size=10, xytext=(4.5, 4.5), textcoords='offset points')
    plt.annotate(txt, (x[i], z[i]), size=10, xytext=(4.5, 4.5), textcoords='offset points')

plt.grid(alpha=0.5)
plt.legend(loc='upper left')
plt.show()
```
<figcaption>Bloque de c√≥digo para la graficaci√≥n de proyecciones ortogonales.</figcaption>

<br>

Output:

<div style="text-align:center">
{% include aligner.html images="posts-img/95X001A_ortogonal.png" column=1 %}
<figcaption>Proyecciones ortogonales de la muestra 95X001A.</figcaption>
</div>

<br>

#### Diagramas de desmagnetizaci√≥n
Cuando un im√°n se expone a altas temperaturas, el calor puede causar que los dominios magn√©ticos dentro del material se agiten y se desorganicen. Los dominios magn√©ticos son √°reas dentro del im√°n donde el campo magn√©tico es uniforme y apunta en la misma direcci√≥n. Al calentarse, la energ√≠a t√©rmica puede hacer que estos dominios se muevan, giren o incluso se inviertan de direcci√≥n, lo que hace que el campo magn√©tico global del im√°n se debilite o desaparezca por completo. La temperatura a la que esto ocurre depende del tipo de im√°n y su composici√≥n, pero en general, cuanto m√°s alta sea la temperatura, m√°s r√°pidamente perder√° sus propiedades magn√©ticas el im√°n.

Es debido a esto que cuando tenemos objetos que contienen imanes y estos se exponen a altas temperaturas, pierden su magnetismo y por lo tanto, dejan de funcionar correctamente. Por ejemplo, las tarjetas de cr√©dito que se pasan por la secadora dejan de funcionar en los cajeros, as√≠ como las antiguas cintas de cassettes que se dejaban en el tablero del coche bajo el sol, dejaban de sonar igual o perd√≠an el audio por completo. En el siguiente video se explica este efecto de una manera m√°s gr√°fica:

<br>

<iframe width="100%" height="600" src="https://www.youtube-nocookie.com/embed/Gv7ODvxQ14I" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<figcaption>Magnetizaci√≥n y desmagnetizaci√≥n explicada.</figcaption>

<br>

De la misma manera, las rocas contienen muchos imanes peque√±os y con el tiempo estos pueden cambiar de direcci√≥n o incluso crecer, lo que puede dificultar saber la direcci√≥n de magnetizaci√≥n original. Sin embargo, algunas partes de la roca a√∫n pueden tener la direcci√≥n de magnetizaci√≥n original. Una ventaja es que las partes magn√©ticas d√©biles de la roca son m√°s propensas a cambiar o aleatorizarse con el tiempo en comparaci√≥n con las partes magn√©ticas m√°s fuertes que mantienen la direcci√≥n magn√©tica antigua.[^1]

Un diagrama de desmagnetizaci√≥n muestra la magnetizaci√≥n remanente de una muestra de roca en funci√≥n del campo magn√©tico aplicado durante la desmagnetizaci√≥n. La magnetizaci√≥n remanente es la cantidad de magnetismo que queda despu√©s de que la muestra se ha desmagnetizado. La magnetizaci√≥n remanente se mide en unidades de magnetizaci√≥n como amperios por metro $$(A/m)$$ o en unidades de polarizaci√≥n magn√©tica como los teslas $$(T)$$.

En *PmagPy* se pueden generar estos diagramas de desmagnetizaci√≥n con la funci√≥n `ipmag.plot_dmag()`, a continuaci√≥n se muestra un ejemplo de su uso:

```python
example = pd.read_csv('xitle_data/dec_inc_calculated/95X001A.csv') # Cargamos los datos de la muestra 95X001A

# Renombramos las columnas para que sean compatibles con la funci√≥n
example.rename(columns={'sample': 'specimen', 'step': 'treat_ac_field', 'M': 'magn_moment'}, inplace=True)

# Si no contamos con una columna de calidad, la creamos y la llenamos con el valor default 'g',
# esto indica que los datos son confiables
example['quality'] = 'g'

plt.figure(figsize=(10, 5)) # Creamos una figura de 10x5
ipmag.plot_dmag(data=example, title="95X001A", fignum=1) # Graficamos el diagrama de desmagnetizaci√≥n
plt.grid(alpha=0.3) # Agregamos una cuadr√≠cula
plt.tight_layout() # Ajustamos el layout
plt.show()
```
<figcaption>Bloque de c√≥digo para la graficaci√≥n de diagramas de desmagnetizaci√≥n.</figcaption>

<br>

Output:

{% include aligner.html images="posts-img/95X001A_demag.png" column=1 %}
<figcaption>Diagrama de desmagnetizaci√≥n de la muestra 95X001A.</figcaption>

<br>


#### Estad√≠sticas de Fisher
Las estad√≠sticas de Fisher son un conjunto de t√©cnicas matem√°ticas utilizadas en paleomagnetismo para analizar la distribuci√≥n de orientaciones magn√©ticas en las rocas. Estos m√©todos fueron desarrollados por *Ronald A. Fisher*, un estad√≠stico brit√°nico, a principios de la d√©cada de 1950.

Las estad√≠sticas de Fisher se basan en el an√°lisis de los vectores que representan las direcciones magn√©ticas registradas en la roca. Permiten a los paleomagnetistas determinar si un conjunto de datos es consistente con una cierta direcci√≥n del campo geomagn√©tico y calcular los l√≠mites de confianza en la estimaci√≥n de la direcci√≥n.

> _It is sometimes said that statistical analyses are used by scientists in the same manner that a drunk uses a light pole: more for support than for illumination. Although this might be true, statistical analysis is fundamental to any paleomagnetic investigation._ Lisa Tauxe, Essentials of Paleomagnetism: Fifth Web Edition, 2018.

En *PmagPy* podemos obtener las estad√≠sticas de Fisher por medio de la funci√≥n `ipmag.fisher_mean()`, la cual toma como par√°metros las inclinaciones y declinaciones medidas de una muestra. A continuaci√≥n se muestra un ejemplo de su uso:

```python
example = pd.read_csv('xitle_data/dec_inc_calculated/95X001A.csv') # Cargamos los datos de la muestra 95X001A

# Se convierten las columnas de declinaci√≥n e inclinaci√≥n a listas
example_decs = example['calc_dec'].to_list()
example_incs = example['calc_inc'].to_list()

# Se calculan las estad√≠sticas de Fisher
fisher_example = ipmag.fisher_mean(example_decs, example_incs)
print(fisher_example)
```
<figcaption>Bloque de c√≥digo para el c√°lculo de las estad√≠sticas de Fisher.</figcaption>

<br>

Output:

```
{
    'dec': 44.89886450502263, 
    'inc': -44.07076593082369, 
    'n': 17, 
    'r': 16.978915065585724, 
    'k': 758.8356541989995, 
    'alpha95': 1.295732152200954, 
    'csd': 2.9404320972016995
}
```

<br>

Donde:

- `dec`: Promedio de los valores de declinaci√≥n.
- `inc`: Promedio de los valores de inclinaci√≥n.
- `n`: N√∫mero de direcciones medidas.
- `r`: Longitud del vector resultante.
- `k`: Par√°metro de precisi√≥n de Fisher.
- `alpha95`: Radio angular de confianza del 95%.
- `csd`: *Circular Standard Deviation*.

<br>

## Magnetics Information Consortium (MagIC)
El [Consorcio de Informaci√≥n Magn√©tica (*MagIC*)](https://www2.earthref.org/MagIC){:target='_blank' rel='noopener noreferrer'} por sus siglas en ingl√©s, es una organizaci√≥n que mejora la capacidad de investigaci√≥n en las Ciencias de la Tierra manteniendo un repositorio digital comunitario y abierto para datos paleomagn√©ticos, con portales que permiten a los usuarios archivar, buscar, visualizar, descargar y combinar estos conjuntos de datos versionados. *MagIC* apoya a las comunidades internacionales dedicadas al paleomagnetismo y se esfuerza por hacer accesibles para todos los datos de archivos privados, haci√©ndolos (re)utilizables para nuevas actividades cient√≠ficas y educativas.

<br>

### Base de datos de MagIC
El formato de base de datos MagIC para datos paleomagn√©ticos es un formato estandarizado utilizado para archivar y compartir datos paleomagn√©ticos de manera consistente. Es un formato de archivo de texto delimitado por tabuladores que contiene columnas espec√≠ficas para varios tipos de datos, incluyendo informaci√≥n de la muestra, sitio y esp√©cimen, mediciones paleomagn√©ticas y metadatos asociados.

A continuaci√≥n se muestra un ejemplo corto del formato *MagIC* en el que `--` simbolizan un tabulador:

```
tab delimited--contribution
id--version--timestamp--contributor--data_model_version--reference
11927--1--2017-06-22T05:09:47.959Z--@njarboe--3--10.1002/2017GC007049
>>>>>>>>>>
tab delimited--locations
location--location_type--geologic_classes--lithologies--lat_s--lat_n--lon_w--lon_e--continent_ocean--country--age--age_sigma--age_unit
Eastern Sheep Creek--Stratigraphic Section--Extrusive:Igneous:Subaerial--Basaltic-Andesite:Basalt:Andesite--40.70923--40.70923--243.17595--243.17595--North America--United States of America--15.23--0.26--Ma
>>>>>>>>>>
tab delimited--sites
site--location--method_codes--citations--geologic_classes--geologic_types--lithologies--bed_dip--bed_dip_direction--lat--lon--age--age_sigma--age_unit--dir_dec--dir_inc--dir_alpha95--dir_k--dir_n_sample--analysts
E28--Eastern Sheep Creek--GM-ARAR:LT-AF-Z:SO-SM:LP-DIR-AF:FS-FD--This study--Extrusive:Igneous--Lava Flow--Basaltic Lava--6--79.6--40.7--243.2--15.23--0.26--Ma--357.3--47.6--1.4--1949.1--7--Bogue
```

En la [documentaci√≥n](https://www2.earthref.org/MagIC/help/text-file-format){:target='_blank' rel='noopener noreferrer'} tambi√©n se incluye un archivo de Excel en el que se encuentran las columnas requeridas para cada secci√≥n del formato *MagIC*, esta es una forma m√°s sencilla de comprender los datos necesarios para utilizar este formato.

En la siguiente imagen se describe el proceso que seguir√≠a un proyecto de Paleomagnetismo desde la recolecci√≥n de muestras, su procesamiento y la conversi√≥n de datos a formato *MagIC*.

<br>

<div style="text-align:center">
{% include aligner.html images="posts-img/magic_process.jpg" column=1 %}
<figcaption>Flujo de trabajo de un proyecto t√≠pico de Paleomagnetismo que utiliza PmagPy y se integra con la base de datos MagIC. Recuperado de <a href="https://doi.org/10.1002/2016GC006307">https://doi.org/10.1002/2016GC006307</a>.</figcaption>
</div>

<br>

*PmagPy* puede utilizarse de manera independiente a la base de datos *MagIC*, sin embargo, muchos componentes de la librer√≠a de Python, as√≠ como la GUI (*Graphical User Interface*) y la CLI (*Command Line Interface*) est√°n dise√±ados para trabajar con datos en formato *MagIC*. Por lo tanto, si se le quiere sacar el m√°ximo provecho a *PmagPy* es recomendable que los datos se encuentren en este formato.[^5]

<br>

#### Comentarios, sugerencias y opiniones
_Espero que este post haya sido de inter√©s para ti, si es as√≠ comp√°rtelo en tus redes. ¬°Te lo agradecer√≠a mucho!_

_Si tienes alg√∫n comentario, sugerencia u opini√≥n h√°zmelo saber en los comentarios de abajo, no requieres de ninguna cuenta, s√≥lo elige un nombre de usuario (puede ser tu nombre) y un correo (opcional). Todos los comentarios son enviados a un moderador, por lo tanto tardar√°n un poco en publicarse._

<br>

[^1]: {% include citation.html key="tauxe" %}
[^2]: {% include citation.html key="chatgpt" %}
[^3]: {% include citation.html key="copilot" %}
[^4]: {% include citation.html key="xitle" %}
[^5]: {% include citation.html key="pmagpy" %}